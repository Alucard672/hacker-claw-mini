<view class="container">
  <scroll-view 
    class="chat-list" 
    scroll-y 
    scroll-with-animation 
    scroll-into-view="{{lastMessageId}}">
    
    <view wx:for="{{messages}}" wx:key="id" id="{{item.id}}" class="message-item {{item.type}}">
      <view class="msg-header">
        <text class="time">[{{item.time}}]</text>
        <text class="user-id">{{item.type === 'user' ? userPhone : assistantName}}@{{item.type === 'user' ? 'ç»ˆç«¯' : 'ç³»ç»Ÿ'}}#</text>
      </view>
      
      <view class="msg-body">
        <text wx:if="{{item.text}}" selectable>{{item.text}}</text>
        <image 
          wx:if="{{item.image}}" 
          src="{{item.image}}" 
          mode="widthFix" 
          class="msg-image"
          bindtap="previewImage"
          data-src="{{item.image}}"></image>
        <view 
          wx:if="{{item.file}}" 
          class="msg-file" 
          bindtap="openFile" 
          data-url="{{item.file}}">
          <text>ğŸ“„ {{item.fileName || 'æ–‡ä»¶ä¸‹è½½'}}</text>
        </view>
      </view>
    </view>
    
    <view class="typing-indicator" wx:if="{{isTyping}}">
      <text>æ­£åœ¨åˆ†æè¾“å…¥æ•°æ®...</text>
    </view>
    
    <view id="bottom-anchor"></view>
  </scroll-view>

  <view class="input-area">
    <view class="input-box">
      <input 
        class="main-input" 
        value="{{inputValue}}" 
        placeholder="è¾“å…¥æŒ‡ä»¤..." 
        placeholder-style="color: #004400"
        bindinput="onInput"
        bindconfirm="sendMessage"
        confirm-type="send"
      />
      <view class="send-btn" bindtap="sendMessage">æ‰§è¡Œ</view>
    </view>
    <view class="tool-bar">
      <view class="tool-item" bindtap="chooseImage">å›¾ç‰‡</view>
      <view class="tool-item" bindtap="chooseFile">æ–‡ä»¶</view>
      <view class="tool-item" bindtouchstart="startVoice" bindtouchend="stopVoice">è¯­éŸ³</view>
      <view class="tool-item logout" bindtap="logout">é€€å‡º</view>
    </view>
  </view>
</view>